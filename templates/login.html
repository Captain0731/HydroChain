{% extends "base.html" %}

{% block title %}Login - HydroChain{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center min-vh-100 align-items-center">
        <div class="col-md-6 col-lg-4">
            <div class="card bg-dark-secondary border-0 shadow-lg">
                <div class="card-body p-4">
                    <div class="text-center mb-4">
                        <i class="fas fa-bolt text-primary fa-3x mb-3"></i>
                        <h2 class="text-light">Welcome Back</h2>
                        <p class="text-muted">Connect your wallet to access HydroChain</p>
                    </div>

                    <!-- MetaMask Login -->
                    <div class="mb-4">
                        <button class="btn btn-primary w-100 py-3" id="metamaskLogin">
                            <i class="fab fa-ethereum me-2"></i>
                            Connect with MetaMask
                        </button>
                        <small class="text-muted d-block text-center mt-2">
                            Recommended for secure access
                        </small>
                    </div>

                    <div class="divider text-center my-4">
                        <span class="text-muted">or</span>
                    </div>

                    <!-- Manual Login Form -->
                    <form method="POST" id="loginForm">
                        <div class="mb-3">
                            <label for="username" class="form-label text-light">Username</label>
                            <input type="text" class="form-control bg-dark text-light border-secondary" 
                                   id="username" name="username" required>
                        </div>
                        
                        <div class="mb-4">
                            <label for="wallet_address" class="form-label text-light">Wallet Address</label>
                            <input type="text" class="form-control bg-dark text-light border-secondary" 
                                   id="wallet_address" name="wallet_address" 
                                   placeholder="0x..." required>
                            <small class="text-muted">Enter your Ethereum wallet address</small>
                        </div>
                        
                        <button type="submit" class="btn btn-outline-primary w-100 py-2">
                            <i class="fas fa-sign-in-alt me-2"></i>
                            Manual Login
                        </button>
                    </form>

                    <div class="text-center mt-4">
                        <p class="text-muted mb-0">
                            New to HydroChain? 
                            <a href="#" class="text-primary" data-bs-toggle="modal" data-bs-target="#infoModal">
                                Learn More
                            </a>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Info Modal -->
<div class="modal fade" id="infoModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content bg-dark-custom border-0">
            <div class="modal-header border-secondary">
                <h5 class="modal-title text-light">Getting Started with HydroChain</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row g-4">
                    <div class="col-md-6">
                        <div class="d-flex">
                            <div class="flex-shrink-0">
                                <i class="fab fa-ethereum text-primary fa-2x"></i>
                            </div>
                            <div class="flex-grow-1 ms-3">
                                <h6 class="text-light">MetaMask Wallet</h6>
                                <p class="text-muted mb-0">
                                    Install MetaMask browser extension for secure wallet connection and seamless trading.
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="d-flex">
                            <div class="flex-shrink-0">
                                <i class="fas fa-bolt text-success fa-2x"></i>
                            </div>
                            <div class="flex-grow-1 ms-3">
                                <h6 class="text-light">Hydrogen Credits</h6>
                                <p class="text-muted mb-0">
                                    Trade verified hydrogen offset credits from renewable energy projects worldwide.
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="d-flex">
                            <div class="flex-shrink-0">
                                <i class="fas fa-shield-alt text-info fa-2x"></i>
                            </div>
                            <div class="flex-grow-1 ms-3">
                                <h6 class="text-light">Verified Projects</h6>
                                <p class="text-muted mb-0">
                                    All credits are certified by recognized third-party auditors for authenticity.
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="d-flex">
                            <div class="flex-shrink-0">
                                <i class="fas fa-globe text-warning fa-2x"></i>
                            </div>
                            <div class="flex-grow-1 ms-3">
                                <h6 class="text-light">Global Market</h6>
                                <p class="text-muted mb-0">
                                    Access hydrogen credits from projects across 15+ countries and growing.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer border-secondary">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">
                    Get Started
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const metamaskBtn = document.getElementById('metamaskLogin');
    const loginForm = document.getElementById('loginForm');
    
    metamaskBtn.addEventListener('click', async function() {
        this.disabled = true;
        this.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Connecting...';
        
        try {
            const result = await connectWallet();
            if (result.success) {
                window.location.href = '/dashboard';
            }
        } catch (error) {
            console.error('MetaMask connection failed:', error);
        } finally {
            this.disabled = false;
            this.innerHTML = '<i class="fab fa-ethereum me-2"></i>Connect with MetaMask';
        }
    });
    
    // Validate wallet address format
    const walletInput = document.getElementById('wallet_address');
    walletInput.addEventListener('input', function() {
        const address = this.value;
        if (address && (!address.startsWith('0x') || address.length !== 42)) {
            this.setCustomValidity('Please enter a valid Ethereum address (0x...)');
        } else {
            this.setCustomValidity('');
        }
    });
});
</script>
{% endblock %}
